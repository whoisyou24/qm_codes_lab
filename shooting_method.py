# Shooting Method with RK4: Ground and First Excited States (Side-by-Side)


import numpy as np
import matplotlib.pyplot as plt
import math

L = 1.0
dx = 0.001
slope0 = 0.01   # initial slope

# Analytical solutions
def analytic_energy(n):
    return (n * math.pi / L) ** 2

def analytic_psi(n, x):
    return math.sqrt(2.0 / L) * np.sin(n * math.pi * x / L)

# RK4 integrator

def rk4_step(x, y, E, dx):
    def deriv(xi, yi):
        psi, phi = yi
        return np.array([phi, -E * psi])  

    k1 = deriv(x, y)
    k2 = deriv(x + dx/2, y + dx*k1/2)
    k3 = deriv(x + dx/2, y + dx*k2/2)
    k4 = deriv(x + dx, y + dx*k3)

    return y + dx * (k1 + 2*k2 + 2*k3 + k4) / 6

# Integrate wavefunction

def integrate_wavefunction(E):
    N = int(L/dx)
    xs = np.linspace(0, L, N+1)
    psi = np.zeros_like(xs)
    phi = np.zeros_like(xs)

    psi[0] = 0.0
    phi[0] = slope0
    y = np.array([psi[0], phi[0]])

    for i, x in enumerate(xs[:-1]):
        y = rk4_step(x, y, E, dx)
        psi[i+1], phi[i+1] = y

    return xs, psi

# Normalize wavefunction

def normalize_wavefunction(xs, psi):
    norm = math.sqrt(np.trapezoid(psi**2, xs))  # integral ψ² dx
    return psi / norm

# Plot ground (n=1) and first excited (n=2) side by side

def plot_ground_and_excited():
    xs = np.linspace(0, L, int(L/dx)+1)

    fig, axes = plt.subplots(1, 2, figsize=(14,5))

    for idx, n in enumerate([1, 2]):
        En = analytic_energy(n)
        ax = axes[idx]

        # Numerical solutions for undershoot, correct, overshoot
        for f, style in zip([0.9, 1.0, 1.1], ["b", "g", "r"]):
            E_trial = En * f
            xs, psi = integrate_wavefunction(E_trial)
            psi_norm = normalize_wavefunction(xs, psi)
            ax.plot(xs, psi_norm, style, label=f"E={E_trial:.2f}")

        # Analytic solution
        psi_analytic = analytic_psi(n, xs)
        ax.plot(xs, psi_analytic, 'k--', linewidth=2, label="Analytic")

        ax.set_title(f"State n={n}")
        ax.set_xlabel("x")
        ax.set_ylabel("ψ(x)")
        ax.legend()
        ax.grid(True)

    plt.suptitle("Normalized Wavefunctions: Ground (n=1) and First Excited (n=2)")
    plt.show()

plot_ground_and_excited()



























































































































































































































































































































































































































































































































































































































































































































































































































































































































